1.Docker Networking	Part One														(IntelliQ IT Trainings)		[12-MAR-2021]  (Done)
2.Docker Networking																	(aquasec)					[15-MAR-2021]  (Done)
3.Docker Networking																	(edureka)					[12-MAR-2021]  ()
4.Docker Networking	Host Network													()							[12-MAR-2021]  ()
5.Docker Networking	None Network													()							[12-MAR-2021]  ()
6.Docker Networking	Overlay Network													(SysTechInfra Solutions)	[12-MAR-2021]  ()
7.Deploying Multiple Spring Boot Microservices using Docker Networking				(javainuse)					[16-MAR-2021]  (Done)
8.Docker Networking																	(Developers Thought)		[16-MAR-2021]  ()


********************************************************* 13.Docker Networking (IntelliQ IT Trainings) ***************************************************************

Docker generally uses the following type of Networks 

1.Bridge
2.Host or Host Only
3.null
4.Macvlan   (Used in legacy systems)
5.Overlay	(Used in Container Orcchestration tools like Docker Swam)

When Multiple Docker Containers run on the Single Machine or Single Host,the default network used by Docker is Bridge Network.
Consider the case we have created Multiple Containers in the Single Host i.e Ubuntu Container,Tomcat Container,PHP Container etc.
All these Containers are connected using Bridge Network and can communicate with each other.

Here --link tag is deprecated because of Bridge Network.

How we can create a Multi Container Architecture where different containers can communicate with each other.
Consider the scenario where 

Wordpress Container can communicate with MySql Container
Ghost Container (Blogging Software) can communicate with MySql Container.

Here we are creating two different architecture for two different Projects.
Problem with this approach is all these containers are running on the same machine via Bridge Network and can communicate with each other.
Problem to the solution is we want to restrict certain Containers to communicate among themselves.
This can be done by virtual bridge networks(Docker Networking).

Create 2 Bride Networks named Bridge1 and Bridge2.
Create 3 Busy Box Containers named C1,C2 and C3.

Scenario One :
Instead of C1,C2,C3 allowing to run on the default Bridge Network,we put C1 and C2 on the Bridge1 and C3 on Bridge 2.
Here C1 and C2 can communicate with each Other where as C3 cannot Communicate with C1 and C2.

To craete a Docker Network 

	docker network craete --driver bridge Bridge1
	docker network craete --driver bridge Bridge2
	
To view the networks 

	docker network ls
	
Run the BusyBox Container C1 and C2 in the Bridge Network Bridge1 and Container C3 in Bridge Network2

	docker run --name C1 -it --network Bridge1 busybox
	docker run --name C2 -it --network Bridge1 busybox
	docker run --name C3 -it --network Bridge2 busybox

To come out of the container without exiting and stopping it CTRL+P CTRL+Q

To identify the IP Address of the container 

	docker inspect C1
	
	172.21.0.2	(Bridge1)
	
	docker inspect C2
	
	172.21.0.3   (Bridge1)
	
	dokcer inspect C3
	
	172.22.0.2   (Bridge2)
	
Scenario Two :
Single Container can run paralelly on multiple Networks.
Here C2 Container can run on Bridge1 as well as Bridge2.

	docker network connect Bridge2 C2
	
To check whether C2 is connected to Bridge2 Attach the C2 Container
	
	docker attach C2

	docker inspect C2
	
Note :
Default Network used by Docker when Multiple Containers running on the same Machine is Bridge Network. 


******************************************************************* 2.Docker Networking(aquasec)  *********************************************************************

For Docker Containers to communicate with each other and outside the world via host machine,there has to be a layer of networking involved.
Docker supports different types of networks,each fit for certain use case.

For example building an Application which runs on a Single Docker Container will have different Network Setup compared to
Web Application with a cluster of databases,application,load balancers which span multiple containers that needs to communicate with each other.

Docker Default Networking :
---------------------------
When Docker is installed,default bridge network named docker0 is created.
Each new Docker Container is automatically attached to this network unless,custom network is specified.

Besides docker0 two other networks get created automatically by Docker i.e host and none

Host :
------ 
Host Network removes the Network isolation between the Docker Host and Docker containers to use the Host's Network directly.
With this we will not be able to run multiple web Containers on the same host,on the same port as the port is now common to all the containers on the network.
To the outside world they are on the same network.

NONE : 
------
In this kind of network,Containers are not attached to any network and do not have access to the external network or other Containers.
This network can be used whenever we want to completely disable the networking stack on a Container and only create a loop back device.

Docker Networking Types :
-------------------------
Docker comes with network drivers geared towards different usecases.
Most Common Network types are 

Bridge
Overlay
Macvlan

Bridge :
--------
Bridge network is the most common Network Type.
It is limited to containers within a Single host running the Docker Engine.
Bridge network are easy to create,manage and troubleshoot.

For the Containers on Bridge network to communicate or to be reachable from outside world,port mapping needs to be configured.
Consider the case we have Docker Container running the Web Service on port 80.
Because this Container is attached to the Bridge Network on a private subnet,
port on host system like 8500 needs to be mapped to port 80 on the Container for the outside traffic to reach the Web Service.

To create a Bridge network named Bridge3 pass the argument bridge to the -d parameter.

	docker network create -d bridge Bridge3
	
In case of Bridge Network all the Containers get an Internal IP Address and these Containers can access each other using the Internal IP.
Bridge Networks are usually used when our Application runs in Stand alone Containers that needs to Communicate.

	
Overlay :
---------
After Docker Swarm

Macvlan :
---------
After Docker Swarm

Container discovery on docker0 network (DNS resolution) :
---------------------------------------------------------
Different network provides different communication patterns between the containers depending on the network type whether it is default docker network or user defined network.

Docker will assign name and hostName to each Container created on the default docker0 network unless different name/hostName is specified by the user.
Docker then keeps mapping of each name/hostName against the Container's IP Address.
This mapping allows pinging each Container by name as opposed to IP Address.

Example :
After DNS Video


Directly linking containers :
-----------------------------
It is possible to directly link one Container to the another using the --link option when starting the Container.
This allows Containers to discover each other and securely tarnsfer information about One Container with other Container.
However Docker has deprecated this feature and recomended to use user defined network instead.

Example :
After LInking Video


Exposing Ports and Forwarding Traffic :
---------------------------------------
Docker network use private subnets that cannot be accessed from the outside world.
To allow requests from the internet to reach to the Container,we need to map Container port to the port on the Container Host.

	-p 8500:80

Containers Connected to Multiple Networks :
-------------------------------------------
Finegrained network policies for connectivity and isolation can be achieved by joining containers to multiple networks.
By default each Container will be attached to single network.
More networks can be attached to a Container by creating it first with the 

	docker create 

instead of 

	docker run 

and then running the command 
 
	docker network connect

How IPv6 Works on Docker :
--------------------------
By default Docker configures the Container networks for IPv4 only.
To enable the IPv4/IPv6 dual stack  --ipv6 flag needs to be applied when starting the Docker Daemon.
Then the docker0 bridge will get an IPv6 link -loacal address.

To assign globally IPv6 address to all the Containers assign the flag  --fixed-cidr-v6 followed by IPv6 Address.

Common Operations :
-------------------
To insepct a network  						:  docker network inspect 
To list all the networks   					:  docker network ls
To create a network							:  docker network create
To connect the Container to the network 	:  docker network connect Bridge1 C1
To disconnect the Container to the network	:  docker network disconect Bridge1 C1
To remove the network 						:  docker network rm Bridge1


Docker Networking with Multiple Hosts :
---------------------------------------
After Docker Swarm



*************************************** 7.Deploying Multiple Spring Boot Microservices using Docker Networking (javainuse)  *****************************************

Create two Microservice named 

1.employee-producer  
2.employee-consumer 

Dockerfile and Docker build commands can be used to create a Single service into the Container.
If the requirement is in such a way that we need to deploy multiple microservices into the multiple Docker Container
and each Container has to communicate with each other.
Here employee-producer will be exposing Rest API which will be consumed by the employee-consumer.

Docker has designed in such a way that Docker Container should have only Single running Service.
Here we will be deploying two micro services into two different Containers and and we make them interact with each other.

After starting the two containers if we hit the url on the browser i.e http://localhost:8500/consumer we won't get any output.
Here we have to make the Containers communicate with each other.
We wil be using Docker networking to allow multiple Containers to interact with each other.
Here we need to create our own network and add the Containers to the network.

	docker network create producer-consumer

	docker run --network producer-consumer --name producer -d -p 8501:8500 employee-consumer

	docker run --network producer-consumer --name consumer -d -p 8601:8600 employee-producer

To check the logs of the Container

	docker logs [ContainerName]
	
Example :

To run the Consumer Application 
	
	http://localhost:8501/consumer and in the Consumer Application,to call the producer Application 
	
	String baseUrl = "http://producer:8600/employee";  (Pass the Producer Image Name)

To run the producer Application

	http://localhost:8601/employee
	

*************************************** 3.Docker Networking	Overlay Network(SysTechInfra Solutions)	  ***************************************************************





